<form action="jsp/site/Portal.jsp">
    <div class="form-group row">
            <input type="hidden" name="page" value="initializer"/>
            <label for="name" class="col-sm-12 col-md-3 col-form-label">#i18n{initializer.initialize.searchComponent.label} ?</label>
            <div class="col-sm-12 col-md-9">
                    <input type="text" id="search_component" name="search_component" data-provide="typeahead" value="" maxlength="50" class="form-control typeahead twitter-typeahead" placeholder="#i18n{initializer.initialize.searchComponent.placeholder}" aria-describedby="searchComponentHelpBlock" />
                    <small id="searchComponentHelpBlock" class="form-text text-muted">#i18n{initializer.initialize.searchComponent.help}</small>
            </div>
            <div class="col-sm-12 col-md-9 col-md-offset-3">
                    <input type="checkbox" checked id="search_only_in_starters"/>
                    <label>#i18n{initializer.initialize.searchOnlyInStarter.label}</label>
            </div>
            
            <div class="col-sm-12 col-md-6">
                    <label>#i18n{initializer.initialize.artifactId.label}</label>
                    <input type="text" id="artifact_id" name="artifact_id" class="form-control" />
            </div>
            <div class="col-sm-12 col-md-6">
                    <label>#i18n{initializer.initialize.groupId.label}</label>
                    <input type="text" id="group_id" name="group_id" class="form-control" />
            </div>
            <div class="col-sm-12 col-md-6">
                    <label>#i18n{initializer.initialize.version.label}</label>
                    <input type="text" id="version" name="version" class="form-control" />
            </div>
            <div class="col-sm-12 col-md-6">
                    <label>#i18n{initializer.initialize.componentType.label}</label>
                    <input type="text" id="component_type" name="component_type" class="form-control" />
            </div>
            <div class="col-sm-12 col-md-12">
                    <label>#i18n{initializer.initialize.siteName.label}</label>
                    <input type="text" id="site_name" name="site_name" class="form-control" />
            </div>
    </div>
    <div class="form-group row">
            <div class="col-sm-12 col-md-6 col-md-offset-3" id="selected_comp">
            </div>
    </div>
    <div class="form-group row">
        <div class="col-sm-12 col-md-6 col-md-offset-3">
            <button type="submit"  id="btn_download_site_pom" name="action_doDownloadPomSite">#i18n{initializer.initialize.generatePom}</button>
        <div>
    </div>
    
        <#list categories_list as category>
        <div class="form-group row">
             <label for="name" class="col-form-label">#i18n{${(category.labelKey)!''}}</label><br/>
             <#list components_list as component>
                <#if component.codeCategory == category.code>
                    <label class="col-sm-10 col-md-10 col-md-offset-1">#i18n{${(component.labelKey)!''}}</label>
                    <input class="col-sm-1 col-md-1 comp_from_list" type="checkbox" name="comp_from_list" value="${(component.artifactId)!''}"/>
                    <small class="col-sm-10 col-md-10 col-md-offset-1">#i18n{${(component.descriptionKey)!''}}</small>
                    <br/>
                </#if>
             </#list>
        </div>

        </#list>
    </div>
            
</form>


<script src="js/bootstrap3-typeahead.min.js"></script>
<script>

var startDatas=[<#list components_list as component>"${(component.artifactId)!''}"+" --- #i18n{${component.descriptionKey}}",</#list>];
var allDatas;
fetchAllArtifactId();
var data = startDatas;



$("#search_only_in_starters").click( function(){
   if( $(this).is(':checked') )
   {
       data=startDatas;
       
   }
   else
    {
       data=allDatas;
    }
    $("#search_component").data('typeahead').source = data;
});

$("#search_component").typeahead({
  source: data,
  autoSelect: true,
  afterSelect: function(item) {
    getFullComponent( item );
    checkInCompList( item.split(" ")[0] );
  }
});
    
$(".comp_from_list").click( function(){
   if( $(this).is(':checked') )
   {
       var artifactId = $(this).val();
       getFullComponent( artifactId );
   }
   else
    {
       var artifactId = $(this).val();
       removeFromSelectedComp( artifactId );
    }
});
 
function getFullComponent( item )
{
    var addNewComp = true;
    $('.comp').each( function( index )
    {
        if ( $(this).val()==item ) 
        {
            addNewComp = false;
            $(this).prop('checked',true);
        }
    });
    if ( addNewComp )
    {
        $.ajax({
            type: "get",
            url: "jsp/site/Portal.jsp",
            data: "page=initializer&action=getFullComponent&id="+item.split(" ")[0],
            success: function( json )
            {
                $("#selected_comp").append('<input type="checkbox" checked class="comp" name="comp" value="'+json.artifact_id+'"/>     '+json.artifact_id+'   version : '+json.version+'<br>');
                return json;
            }
        });
    }
}
    
function checkInCompList( artifactId )
{
    $('.comp_from_list').each( function( index )
    {
        if ( $(this).val()==artifactId )
        {
            $(this).prop('checked',true);
        }
    }); 
}
    
function removeFromSelectedComp( artifactId )
{
    $('.comp').each( function( index )
    {
        if ( $(this).val()==artifactId )
        {
            $(this).prop('checked',false);
        }
    }); 
}
    
function fetchAllArtifactId( )
{
    $.ajax({
            type: "get",
            url: "jsp/site/Portal.jsp",
            data: "page=initializer&action=getAllArtifactId",
            async: true,
            success: function( json )
            {
                setAllDatas ( json ) 
            }
    });
}
    
function setAllDatas( json )
{
    var artifactIdList=[];
    for(var i = 0; i < json.components.length; i++) 
    {
        artifactIdList.push( json.components[i].artifact_id );
    }
    allDatas = artifactIdList;
}
</script>